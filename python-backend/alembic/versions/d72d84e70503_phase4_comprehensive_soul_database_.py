"""phase4_comprehensive_soul_database_enhancement

Revision ID: d72d84e70503
Revises: add_db_indexes
Create Date: 2025-08-08 14:18:53.428937

"""
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = 'd72d84e70503'
down_revision = 'add_db_indexes'
branch_labels = None
depends_on = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_revelations_connection_day'), table_name='daily_revelations')
    op.drop_index(op.f('ix_revelations_connection_id'), table_name='daily_revelations')
    op.drop_index(op.f('ix_revelations_connection_sender'), table_name='daily_revelations')
    op.drop_index(op.f('ix_revelations_created_at'), table_name='daily_revelations')
    op.drop_index(op.f('ix_revelations_day_number'), table_name='daily_revelations')
    op.drop_index(op.f('ix_revelations_sender_day'), table_name='daily_revelations')
    op.drop_index(op.f('ix_revelations_sender_id'), table_name='daily_revelations')
    op.drop_index(op.f('ix_matches_created_at'), table_name='matches')
    op.drop_index(op.f('ix_matches_receiver_id'), table_name='matches')
    op.drop_index(op.f('ix_matches_receiver_status'), table_name='matches')
    op.drop_index(op.f('ix_matches_sender_id'), table_name='matches')
    op.drop_index(op.f('ix_matches_sender_status'), table_name='matches')
    op.drop_index(op.f('ix_matches_status'), table_name='matches')
    op.drop_index(op.f('ix_messages_connection_created'), table_name='messages')
    op.drop_index(op.f('ix_messages_connection_id'), table_name='messages')
    op.drop_index(op.f('ix_messages_connection_unread'), table_name='messages')
    op.drop_index(op.f('ix_messages_created_at'), table_name='messages')
    op.drop_index(op.f('ix_messages_is_read'), table_name='messages')
    op.drop_index(op.f('ix_messages_sender_id'), table_name='messages')
    op.drop_index(op.f('ix_messages_sender_unread'), table_name='messages')
    op.add_column('soul_connections', sa.Column('user1_photo_consent', sa.Boolean(), nullable=True))
    op.add_column('soul_connections', sa.Column('user2_photo_consent', sa.Boolean(), nullable=True))
    op.add_column('soul_connections', sa.Column('photo_revealed_at', sa.DateTime(), nullable=True))
    op.add_column('soul_connections', sa.Column('current_energy_level', sa.String(), nullable=True))
    op.add_column('soul_connections', sa.Column('energy_history', sa.JSON(), nullable=True))
    op.add_column('soul_connections', sa.Column('personality_match_score', sa.DECIMAL(precision=5, scale=2), nullable=True))
    op.add_column('soul_connections', sa.Column('values_alignment_score', sa.DECIMAL(precision=5, scale=2), nullable=True))
    op.add_column('soul_connections', sa.Column('communication_compatibility', sa.DECIMAL(precision=5, scale=2), nullable=True))
    op.add_column('soul_connections', sa.Column('emotional_resonance_score', sa.DECIMAL(precision=5, scale=2), nullable=True))
    op.add_column('soul_connections', sa.Column('total_messages_exchanged', sa.Integer(), nullable=True))
    op.add_column('soul_connections', sa.Column('revelation_completion_percentage', sa.DECIMAL(precision=5, scale=2), nullable=True))
    op.add_column('soul_connections', sa.Column('average_response_time_minutes', sa.Integer(), nullable=True))
    op.add_column('soul_connections', sa.Column('mutual_engagement_score', sa.DECIMAL(precision=5, scale=2), nullable=True))
    op.add_column('soul_connections', sa.Column('first_message_at', sa.DateTime(), nullable=True))
    op.add_column('soul_connections', sa.Column('last_message_at', sa.DateTime(), nullable=True))
    op.add_column('soul_connections', sa.Column('revelation_started_at', sa.DateTime(), nullable=True))
    op.add_column('soul_connections', sa.Column('stage_progression_dates', sa.JSON(), nullable=True))
    op.add_column('soul_connections', sa.Column('conversation_depth_score', sa.DECIMAL(precision=5, scale=2), nullable=True))
    op.add_column('soul_connections', sa.Column('emotional_openness_level', sa.Integer(), nullable=True))
    op.add_column('soul_connections', sa.Column('mutual_satisfaction_rating', sa.DECIMAL(precision=5, scale=2), nullable=True))
    op.add_column('soul_connections', sa.Column('last_activity_at', sa.DateTime(), nullable=True))
    op.add_column('soul_connections', sa.Column('active_users_count', sa.Integer(), nullable=True))
    op.add_column('soul_connections', sa.Column('is_typing_active', sa.Boolean(), nullable=True))
    op.add_column('soul_connections', sa.Column('end_reason', sa.String(), nullable=True))
    op.add_column('soul_connections', sa.Column('ended_by', sa.Integer(), nullable=True))
    op.add_column('soul_connections', sa.Column('ended_at', sa.DateTime(), nullable=True))
    op.add_column('soul_connections', sa.Column('success_prediction_score', sa.DECIMAL(precision=5, scale=2), nullable=True))
    op.add_column('soul_connections', sa.Column('ml_model_version', sa.String(), nullable=True))
    op.add_column('soul_connections', sa.Column('prediction_confidence', sa.DECIMAL(precision=5, scale=2), nullable=True))
    op.drop_index(op.f('ix_soul_connections_stage'), table_name='soul_connections')
    op.drop_index(op.f('ix_soul_connections_status'), table_name='soul_connections')
    op.drop_index(op.f('ix_soul_connections_user1'), table_name='soul_connections')
    op.drop_index(op.f('ix_soul_connections_user1_status'), table_name='soul_connections')
    op.drop_index(op.f('ix_soul_connections_user2'), table_name='soul_connections')
    op.drop_index(op.f('ix_soul_connections_user2_status'), table_name='soul_connections')
    op.drop_index(op.f('ix_soul_connections_users_status'), table_name='soul_connections')
    op.create_foreign_key(None, 'soul_connections', 'users', ['ended_by'], ['id'])
    op.add_column('users', sa.Column('current_emotional_state', sa.String(), nullable=True))
    op.add_column('users', sa.Column('preferred_animation_speed', sa.Float(), nullable=True))
    op.add_column('users', sa.Column('haptic_feedback_enabled', sa.Boolean(), nullable=True))
    op.add_column('users', sa.Column('reduced_motion_preference', sa.Boolean(), nullable=True))
    op.add_column('users', sa.Column('dark_mode_preference', sa.Boolean(), nullable=True))
    op.add_column('users', sa.Column('total_swipes', sa.Integer(), nullable=True))
    op.add_column('users', sa.Column('total_matches', sa.Integer(), nullable=True))
    op.add_column('users', sa.Column('total_revelations_shared', sa.Integer(), nullable=True))
    op.add_column('users', sa.Column('total_messages_sent', sa.Integer(), nullable=True))
    op.add_column('users', sa.Column('photo_sharing_consent', sa.Boolean(), nullable=True))
    op.add_column('users', sa.Column('analytics_consent', sa.Boolean(), nullable=True))
    op.add_column('users', sa.Column('marketing_consent', sa.Boolean(), nullable=True))
    op.add_column('users', sa.Column('push_notifications_enabled', sa.Boolean(), nullable=True))
    op.add_column('users', sa.Column('email_notifications_enabled', sa.Boolean(), nullable=True))
    op.add_column('users', sa.Column('revelation_reminders', sa.Boolean(), nullable=True))
    op.drop_index(op.f('ix_users_active_age'), table_name='users')
    op.drop_index(op.f('ix_users_active_location'), table_name='users')
    op.drop_index(op.f('ix_users_is_active'), table_name='users')
    op.drop_index(op.f('ix_users_location'), table_name='users')
    op.drop_index(op.f('ix_users_profile_complete'), table_name='users')
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_index(op.f('ix_users_profile_complete'), 'users', ['is_profile_complete'], unique=False)
    op.create_index(op.f('ix_users_location'), 'users', ['location'], unique=False)
    op.create_index(op.f('ix_users_is_active'), 'users', ['is_active'], unique=False)
    op.create_index(op.f('ix_users_active_location'), 'users', ['is_active', 'location'], unique=False)
    op.create_index(op.f('ix_users_active_age'), 'users', ['is_active', 'date_of_birth'], unique=False)
    op.drop_column('users', 'revelation_reminders')
    op.drop_column('users', 'email_notifications_enabled')
    op.drop_column('users', 'push_notifications_enabled')
    op.drop_column('users', 'marketing_consent')
    op.drop_column('users', 'analytics_consent')
    op.drop_column('users', 'photo_sharing_consent')
    op.drop_column('users', 'total_messages_sent')
    op.drop_column('users', 'total_revelations_shared')
    op.drop_column('users', 'total_matches')
    op.drop_column('users', 'total_swipes')
    op.drop_column('users', 'dark_mode_preference')
    op.drop_column('users', 'reduced_motion_preference')
    op.drop_column('users', 'haptic_feedback_enabled')
    op.drop_column('users', 'preferred_animation_speed')
    op.drop_column('users', 'current_emotional_state')
    op.drop_constraint(None, 'soul_connections', type_='foreignkey')
    op.create_index(op.f('ix_soul_connections_users_status'), 'soul_connections', ['user1_id', 'user2_id', 'status'], unique=False)
    op.create_index(op.f('ix_soul_connections_user2_status'), 'soul_connections', ['user2_id', 'status'], unique=False)
    op.create_index(op.f('ix_soul_connections_user2'), 'soul_connections', ['user2_id'], unique=False)
    op.create_index(op.f('ix_soul_connections_user1_status'), 'soul_connections', ['user1_id', 'status'], unique=False)
    op.create_index(op.f('ix_soul_connections_user1'), 'soul_connections', ['user1_id'], unique=False)
    op.create_index(op.f('ix_soul_connections_status'), 'soul_connections', ['status'], unique=False)
    op.create_index(op.f('ix_soul_connections_stage'), 'soul_connections', ['connection_stage'], unique=False)
    op.drop_column('soul_connections', 'prediction_confidence')
    op.drop_column('soul_connections', 'ml_model_version')
    op.drop_column('soul_connections', 'success_prediction_score')
    op.drop_column('soul_connections', 'ended_at')
    op.drop_column('soul_connections', 'ended_by')
    op.drop_column('soul_connections', 'end_reason')
    op.drop_column('soul_connections', 'is_typing_active')
    op.drop_column('soul_connections', 'active_users_count')
    op.drop_column('soul_connections', 'last_activity_at')
    op.drop_column('soul_connections', 'mutual_satisfaction_rating')
    op.drop_column('soul_connections', 'emotional_openness_level')
    op.drop_column('soul_connections', 'conversation_depth_score')
    op.drop_column('soul_connections', 'stage_progression_dates')
    op.drop_column('soul_connections', 'revelation_started_at')
    op.drop_column('soul_connections', 'last_message_at')
    op.drop_column('soul_connections', 'first_message_at')
    op.drop_column('soul_connections', 'mutual_engagement_score')
    op.drop_column('soul_connections', 'average_response_time_minutes')
    op.drop_column('soul_connections', 'revelation_completion_percentage')
    op.drop_column('soul_connections', 'total_messages_exchanged')
    op.drop_column('soul_connections', 'emotional_resonance_score')
    op.drop_column('soul_connections', 'communication_compatibility')
    op.drop_column('soul_connections', 'values_alignment_score')
    op.drop_column('soul_connections', 'personality_match_score')
    op.drop_column('soul_connections', 'energy_history')
    op.drop_column('soul_connections', 'current_energy_level')
    op.drop_column('soul_connections', 'photo_revealed_at')
    op.drop_column('soul_connections', 'user2_photo_consent')
    op.drop_column('soul_connections', 'user1_photo_consent')
    op.create_index(op.f('ix_messages_sender_unread'), 'messages', ['sender_id', 'is_read'], unique=False)
    op.create_index(op.f('ix_messages_sender_id'), 'messages', ['sender_id'], unique=False)
    op.create_index(op.f('ix_messages_is_read'), 'messages', ['is_read'], unique=False)
    op.create_index(op.f('ix_messages_created_at'), 'messages', ['created_at'], unique=False)
    op.create_index(op.f('ix_messages_connection_unread'), 'messages', ['connection_id', 'is_read'], unique=False)
    op.create_index(op.f('ix_messages_connection_id'), 'messages', ['connection_id'], unique=False)
    op.create_index(op.f('ix_messages_connection_created'), 'messages', ['connection_id', 'created_at'], unique=False)
    op.create_index(op.f('ix_matches_status'), 'matches', ['status'], unique=False)
    op.create_index(op.f('ix_matches_sender_status'), 'matches', ['sender_id', 'status'], unique=False)
    op.create_index(op.f('ix_matches_sender_id'), 'matches', ['sender_id'], unique=False)
    op.create_index(op.f('ix_matches_receiver_status'), 'matches', ['receiver_id', 'status'], unique=False)
    op.create_index(op.f('ix_matches_receiver_id'), 'matches', ['receiver_id'], unique=False)
    op.create_index(op.f('ix_matches_created_at'), 'matches', ['created_at'], unique=False)
    op.create_index(op.f('ix_revelations_sender_id'), 'daily_revelations', ['sender_id'], unique=False)
    op.create_index(op.f('ix_revelations_sender_day'), 'daily_revelations', ['sender_id', 'day_number'], unique=False)
    op.create_index(op.f('ix_revelations_day_number'), 'daily_revelations', ['day_number'], unique=False)
    op.create_index(op.f('ix_revelations_created_at'), 'daily_revelations', ['created_at'], unique=False)
    op.create_index(op.f('ix_revelations_connection_sender'), 'daily_revelations', ['connection_id', 'sender_id'], unique=False)
    op.create_index(op.f('ix_revelations_connection_id'), 'daily_revelations', ['connection_id'], unique=False)
    op.create_index(op.f('ix_revelations_connection_day'), 'daily_revelations', ['connection_id', 'day_number'], unique=False)
    # ### end Alembic commands ###

